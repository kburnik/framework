<?abstract class ApplicationRouter {		protected $routes;		public abstract function getViewProvider( $controllerClassName );		public function __construct( $routes ) 	{		$this->routes = $routes;	}		public function route( $url , $templateViewFilename , $notFoundViewFilename ) 	{					$controller = $this->getControllerForRoute( $url );							if ( $controller instanceOf Controller )		{			return produceview( $templateViewFilename,  $controller );		} 		else 		{			header('HTTP/1.1 404 Not Found');			return produceview( $notFoundViewFilename , array( "url" => $url ) );		}		}			private function getControllerForRoute( $url )	{			$routes = $this->routes;						$controllerMatched = false;				if ( array_key_exists( $url , $routes ) ) 		{					$controllerMatched = true;						list( $controllerClassName , $controllerParams ) = $routes[ $url ];							} 		else 		{								foreach ( $routes as $pattern => $routeInstructions ) 					{							list( $className , $controllerParams , $matchMapping ) = $routeInstructions;												if ( @preg_match(  "/{$pattern}/"  , $url , $matchResults ) ) 				{									foreach ( $matchMapping as $varName => $index )					{											$controllerParams[ $varName ] = $matchResults[ $index ];										}										/*					print_r( array(						matched => $className,						url => $url,						pattern => $pattern,						matchMapping => $matchMapping,						matchResults => $matchResults,						controllerParams => $controllerParams					));					*/										$controllerClassName = $className;										$controllerMatched = true;										break;									}									}							}								if ( $controllerMatched )		{							$viewProvider = $this->getViewProvider( $controllerClassName );												$controller = 				new $controllerClassName				( 					null					, 					$controllerParams					,					$viewProvider									);						return $controller;						}				return null;				}}?>